// services/measurementService.js
const pool = require('../db');

// Servicio para crear la tabla de mediciones
const setupDatabase = async () => {
    await pool.query(`
        CREATE TABLE IF NOT EXISTS measurements (
            sensor_type INTEGER PRIMARY KEY,
            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            value DECIMAL(5,2) NOT NULL
        )
    `);
};

// Servicio para agregar una nueva mediciÃ³n
const addMeasurement = async (sensor_type, value) => {
    await pool.query('DELETE FROM measurements WHERE sensor_type = $1', [sensor_type]);
    await pool.query('INSERT INTO measurements (sensor_type, value) VALUES ($1, $2)', [sensor_type, value]);
};

// Servicio para obtener todas las mediciones
const getMeasurements = async () => {
    const result = await pool.query('SELECT * FROM measurements');
    return result.rows;
};

// Servicio para eliminar todas las mediciones
const deleteMeasurements = async () => {
    await pool.query('DELETE FROM measurements');
};

module.exports = {
    setupDatabase,
    addMeasurement,
    getMeasurements,
    deleteMeasurements
};